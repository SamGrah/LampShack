---
import { Image } from "astro:assets"
const { img, picId, altText } = Astro.props;
const closeId = picId + "-close";
const modalId = picId + "-modal";

// image aspect ratio
const aspectRatio = img.width / img.height;
---

<style>
  /* The Modal (background) */
.modal {
  visibility: hidden; /* Hidden by default */
  display: flex; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  /* overflow: auto; Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
  background-color: #fefefe;
  margin: auto; /* 15% from the top and centered */
  padding: 5px;
  border: 1px solid #888;
  max-width: 80vw; 
  overflow: auto;
  display: flex;
  flex-direction: column;
}

.modal-pic{
  max-width: 50vw;
  max-height: 75vh;
  display: block;
}

/* The Close Button */
.close {
  color: black; 
  padding-right: 5px;
  float: right;
  font-size: 28px;
  font-weight: bold;
  display: block;
  position: absolute;
  align-self: flex-end;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}
</style>

<!-- The Modal -->
<div id={modalId} class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span id={closeId} class="close">&times;</span>
    <Image
      class="modal-pic"
      src={img}
      alt={altText}
      decoding="async"
      loading="lazy"
      layout="constrained"
      aria-hidden="true"
    />
  </div>

</div>

<script define:vars={{picId, closeId, modalId, aspectRatio}}>
  console.log("image aspect ratio", aspectRatio);
  // Get the modal
  var modal = document.getElementById(modalId);

  // Get the button that opens the modal
  var pic = document.getElementById(picId); 

  // Get the <span> element that closes the modal
  var span = document.getElementById(closeId);

  // When the user clicks on the button, open the modal
  pic.onclick = function() {
    modal.style.visibility = "visible";
  }

  // When the user clicks on <span> (x), close the modal
  span.onclick = function() {
    modal.style.visibility = "hidden";
  }

  // When the user clicks anywhere outside of the modal, close it
  modal.onclick = function(event) {
    if (event.target == modal) {
      modal.style.visibility = "hidden";
    }
  }
</script>